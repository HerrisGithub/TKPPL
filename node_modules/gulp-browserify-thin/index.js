"use strict";

var browserify = require('browserify');
var stream = require('vinyl-source-stream');
var util = require('util');

function GulpBrowserify(options)
{
	if (!(this instanceof GulpBrowserify)) {
		return new GulpBrowserify(options);
	}

	browserify.call(this, options);

	var _bundle = this.bundle.bind(this);

	this.bundle = function(filename)
	{
		var through = stream(filename);

		_bundle()
			.on('error', function(err)
			{
				through.emit('error', err);
				this.end();
			})
			.pipe(through);

		return through;
	};
}
util.inherits(GulpBrowserify, browserify);

module.exports = GulpBrowserify;